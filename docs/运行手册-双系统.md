# A股筛选全系统运行手册（trend/reversal/score/value）

本文档记录当前仓库四个系统的逻辑、稳定配置、已验证结果和下次复现步骤。

目标：下次接手时，直接按本文档即可复现当前成功版本。

---

## 1. 系统总览

- `trend`：趋势轨道筛选（大盘 -> 行业强度 -> 个股趋势信号）
- `reversal`：月线反转 5.0 条件筛选
- `score`：趋势候选打分排序（含风险扣分与解释列）
- `value`：生产资料价值模型（支持保守降级并显式打标）

CLI 入口统一为：`src/main.py`

---

## 2. 稳定配置版本（已固定）

### 2.1 Value V1（保守，已接受）

- 配置文件：`config.value_v1.yaml`
- 特征：保守门槛 + Level1/Level2 保守降级兜底
- 用途：默认价值版本，优先控制风险

### 2.2 Value V2（更激进，已接受）

- 配置文件：`config.value_v2.yaml`
- 特征：在 V1 基础上放宽一档估值与质量门槛
- 用途：提高产出数量，用于分层对比/回测

---

## 3. 下次直接运行命令

默认目录：`/mnt/e/akshare`

### 3.1 趋势

```bash
.venv/bin/python -m src.main --date today --config config.yaml --system trend
```

### 3.2 反转（默认）

```bash
.venv/bin/python -m src.main --date today --config config.yaml --system reversal
```

### 3.3 反转（RPS50=80）

```bash
.venv/bin/python -m src.main --date today --config config.reversal80.yaml --system reversal
```

### 3.4 打分

```bash
.venv/bin/python -m src.main --date today --config config.quick.yaml --system score
```

### 3.5 价值 V1

```bash
.venv/bin/python -m src.main --date today --config config.value_v1.yaml --system value
```

### 3.6 价值 V2

```bash
.venv/bin/python -m src.main --date today --config config.value_v2.yaml --system value
```

### 3.7 多系统

```bash
.venv/bin/python -m src.main --date today --config config.quick.yaml --system both
```

### 3.8 公众号简约展示表（一键生成）

```bash
.venv/bin/python -m src.publish_table --date today --output-dir outputs
```

---

## 4. 输出文件与关键字段

输出目录：`outputs/`

- `YYYY-MM-DD_trend_candidates.csv` + `YYYY-MM-DD_trend_summary.json`（仅阳性趋势）
- `YYYY-MM-DD_reversal_candidates.csv` + `YYYY-MM-DD_reversal_summary.json`（仅阳性反转）
- `YYYY-MM-DD_score_candidates.csv` + `YYYY-MM-DD_score_summary.json`
- `YYYY-MM-DD_value_candidates.csv` + `YYYY-MM-DD_value_summary.json`
- `YYYY-MM-DD_4systems_publish_simple.csv` + `YYYY-MM-DD_4systems_publish_simple.md`（公司信息 + 命中策略）

说明：通用汇总文件 `YYYY-MM-DD_candidates.csv` / `YYYY-MM-DD_summary.json` 已停用。

Value 可回溯字段（重要）：

- `degrade_level`
- `missing_fields`
- `replacement_tags`

---

## 5. 本次已验证结果（2026-02-23）

同一市场状态下实跑结果：

- Value V1：`scored_count=6`（候选 6 只）
- Value V2：`scored_count=13`（候选 13 只）

结论：

- V1 作为保守基线可产出且风险约束较强
- V2 在可回溯打标前提下，提供更高覆盖

---

## 6. 每次运行后最少检查项

### 6.1 快速查看 value summary

```bash
.venv/bin/python - <<'PY'
import json
from datetime import datetime
run_date = datetime.now().strftime('%Y-%m-%d')
obj = json.loads(open(f'outputs/{run_date}_value_summary.json', 'r', encoding='utf-8').read())
print('run_date:', obj.get('run_date'))
print('scored_count:', obj.get('scored_count'))
print('degrade_level_used:', obj.get('degrade_level_used'))
print('replacement_counts:', obj.get('coverage', {}).get('replacement_counts', {}))
PY
```

### 6.2 查看候选行数

```bash
RUN_DATE=$(date +%F)
wc -l "outputs/${RUN_DATE}_value_candidates.csv"
```

---

## 7. 一句话操作指南

- 要稳健：跑 `config.value_v1.yaml`
- 要更多标的：跑 `config.value_v2.yaml`
- 要做体系联动：`--system both` 并同时看 score/value 两份 summary
